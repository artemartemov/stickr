import { MIXED_BOOLEAN } from '@create-figma-plugin/utilities';
import { h } from 'preact';
import { useCallback, useEffect, useRef } from 'preact/hooks';
import { IconCheck16 } from '../../icons/icon-16/icon-check-16.js';
import { IconMixed16 } from '../../icons/icon-16/icon-mixed-16.js';
import { createClassName } from '../../utilities/create-class-name.js';
import { createComponent } from '../../utilities/create-component.js';
import { getCurrentFromRef } from '../../utilities/get-current-from-ref.js';
import { noop } from '../../utilities/no-op.js';
import styles from './checkbox.module.css';
export const Checkbox = createComponent(function ({ children, disabled = false, onChange = noop, onKeyDown = noop, onValueChange = noop, propagateEscapeKeyDown = true, value, ...rest }, ref) {
    const inputElementRef = useRef(null);
    const handleChange = useCallback(function (event) {
        onChange(event);
        const newValue = event.currentTarget.checked === true;
        onValueChange(newValue);
    }, [onChange, onValueChange]);
    const handleKeyDown = useCallback(function (event) {
        onKeyDown(event);
        if (event.key === 'Escape') {
            if (propagateEscapeKeyDown === false) {
                event.stopPropagation();
            }
            event.currentTarget.blur();
        }
    }, [onKeyDown, propagateEscapeKeyDown]);
    useEffect(function () {
        const inputElement = getCurrentFromRef(inputElementRef);
        inputElement.indeterminate = value === MIXED_BOOLEAN ? true : false;
    }, [value]);
    const refCallback = useCallback(function (inputElement) {
        inputElementRef.current = inputElement;
        if (ref === null) {
            return;
        }
        if (typeof ref === 'function') {
            ref(inputElement);
            return;
        }
        ref.current = inputElement;
    }, [ref]);
    return (h("label", { class: createClassName([
            styles.checkbox,
            disabled === true ? styles.disabled : null,
            value === MIXED_BOOLEAN ? styles.mixed : null
        ]) },
        h("input", { ...rest, ref: refCallback, checked: value === true, class: styles.input, disabled: disabled === true, onChange: handleChange, onKeyDown: handleKeyDown, tabIndex: 0, type: "checkbox" }),
        h("div", { class: styles.box }, value === MIXED_BOOLEAN ? (h("div", { class: styles.icon },
            h(IconMixed16, null))) : value === true ? (h("div", { class: styles.icon },
            h(IconCheck16, null))) : null),
        h("div", { class: styles.children }, children)));
});
//# sourceMappingURL=checkbox.js.map